!function(e){e.widget("ra.remoteForm",{_create:function(){var i=this,t=i.element,n=t.find("select").first().data("options")&&t.find("select").first().data("options")["edit-url"];"undefined"!=typeof n&&n.length&&t.on("dblclick",".ra-multiselect option",function(e){i._bindModalOpening(e,n.replace("__ID__",this.value))}),t.find(".create").unbind().bind("click",function(t){i._bindModalOpening(t,e(this).data("link"))}),t.find(".update").unbind().bind("click",function(n){(value=t.find("select").val())?i._bindModalOpening(n,e(this).data("link").replace("__ID__",value)):n.preventDefault()})},_bindModalOpening:function(i,t){if(i.preventDefault(),widget=this,e("#modal").length)return!1;var n=this._getModal();setTimeout(function(){e.ajax({url:t,beforeSend:function(e){e.setRequestHeader("Accept","text/javascript")},success:function(e){n.find(".modal-body").html(e),widget._bindFormEvents()},error:function(e){n.find(".modal-body").html(e.responseText)},dataType:"text"})},200)},_bindFormEvents:function(){var i=this,t=this._getModal(),n=t.find("form"),d=t.find(":submit[name=_save]").html(),a=t.find(":submit[name=_continue]").html();t.find(".form-actions").remove(),n.attr("data-remote",!0),t.find(".modal-header-title").text(n.data("title")),t.find(".cancel-action").unbind().click(function(){return t.modal("hide"),!1}).html(a),t.find(".save-action").unbind().click(function(){return n.submit(),!1}).html(d),e(document).trigger("rails_admin.dom_ready"),n.bind("ajax:complete",function(n,d,a){if("error"==a)t.find(".modal-body").html(d.responseText),i._bindFormEvents();else{var l=e.parseJSON(d.responseText),o='<option value="'+l.id+'" selected>'+l.label+"</option>",s=i.element.find("select").filter(":hidden");if(i.element.find(".filtering-select").length){var r=i.element.find(".filtering-select").children(".ra-filtering-select-input");r.val(l.label),s.find("option[value="+l.id+"]").length||(s.html(o).val(l.id),i.element.find(".update").removeClass("disabled"))}else{var r=i.element.find(".ra-filtering-select-input"),c=i.element.find(".ra-multiselect");c.find("option[value="+l.id+"]").length?(s.find("option[value="+l.id+"]").text(l.label),c.find("option[value= "+l.id+"]").text(l.label)):(s.prepend(o),c.find("select.ra-multiselect-selection").prepend(o))}i._trigger("success"),t.modal("hide")}})},_getModal:function(){var i=this;return i.dialog||(i.dialog=e('<div id="modal" class="modal fade">            <div class="modal-header">              <a href="#" class="close" data-dismiss="modal">&times;</a>              <h3 class="modal-header-title">...</h3>            </div>            <div class="modal-body">              ...            </div>            <div class="modal-footer">              <a href="#" class="btn cancel-action">...</a>              <a href="#" class="btn btn-primary save-action">...</a>            </div>          </div>').modal({keyboard:!0,backdrop:!0,show:!0}).on("hidden",function(){i.dialog.remove(),i.dialog=null})),this.dialog}})}(jQuery);